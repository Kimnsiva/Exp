<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Income-Expense Tracker</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Plus, Calendar, CreditCard, Home, Trash2, Edit3 } = lucide;

        const MonthlyExpenseTracker = () => {
          const [currentPage, setCurrentPage] = useState('dashboard');
          const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());
          const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth() + 1);
          const [transactions, setTransactions] = useState([]);
          const [creditInstallments, setCreditInstallments] = useState([]);
          const [showAddForm, setShowAddForm] = useState(false);
          const [showCreditForm, setShowCreditForm] = useState(false);
          const [editingItem, setEditingItem] = useState(null);

          useEffect(() => {
            const sampleTransactions = [
              { id: 1, year: 2025, month: 8, item: 'เงินเดือน', income: 50000, outcome: 0 },
              { id: 2, year: 2025, month: 8, item: 'ค่าเช่าบ้าน', income: 0, outcome: 15000 },
              { id: 3, year: 2025, month: 8, item: 'ค่าอาหาร', income: 0, outcome: 8000 },
              { id: 4, year: 2025, month: 8, item: 'ค่าน้ำมัน', income: 0, outcome: 3000 },
              { id: 5, year: 2025, month: 7, item: 'เงินเดือน', income: 50000, outcome: 0 },
              { id: 6, year: 2025, month: 7, item: 'ค่าเช่าบ้าน', income: 0, outcome: 15000 },
            ];

            const sampleCredit = [
              { id: 1, year: 2025, month: 8, bank: 'KTC', item: 'Practice Test', amount: 3100 },
              { id: 2, year: 2025, month: 9, bank: 'Kbank', item: 'เสื้อผ้า', amount: 1333.33 },
              { id: 3, year: 2025, month: 8, bank: 'SP', item: 'โทรศัพท์', amount: 2500 },
            ];

            setTransactions(sampleTransactions);
            setCreditInstallments(sampleCredit);
          }, []);

          const monthNames = ['มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน', 'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'];

          const getCurrentMonthData = () => {
            return transactions
              .filter(t => t.year === selectedYear && t.month === selectedMonth)
              .sort((a, b) => a.item.localeCompare(b.item));
          };

          const getTotalIncome = (data) => data.reduce((sum, t) => sum + t.income, 0);
          const getTotalOutcome = (data) => data.reduce((sum, t) => sum + t.outcome, 0);
          const getBalance = (data) => getTotalIncome(data) - getTotalOutcome(data);

          const handleAddTransaction = (formData) => {
            if (editingItem) {
              setTransactions(transactions.map(t => t.id === editingItem.id ? { ...editingItem, ...formData } : t));
            } else {
              setTransactions([...transactions, { id: Date.now(), ...formData, income: parseFloat(formData.income) || 0, outcome: parseFloat(formData.outcome) || 0 }]);
            }
            setShowAddForm(false);
            setEditingItem(null);
          };

          const handleAddCredit = (formData) => {
            if (editingItem) {
              setCreditInstallments(creditInstallments.map(c => c.id === editingItem.id ? { ...editingItem, ...formData } : c));
            } else {
              setCreditInstallments([...creditInstallments, { id: Date.now(), ...formData, amount: parseFloat(formData.amount) }]);
            }
            setShowCreditForm(false);
            setEditingItem(null);
          };

          const handleDeleteTransaction = (id) => {
            if (confirm('คุณต้องการลบรายการนี้ใช่หรือไม่?')) {
              setTransactions(transactions.filter(t => t.id !== id));
            }
          };

          const handleDeleteCredit = (id) => {
            if (confirm('คุณต้องการลบรายการนี้ใช่หรือไม่?')) {
              setCreditInstallments(creditInstallments.filter(c => c.id !== id));
            }
          };

          // ... ส่วนอื่นเหมือนเดิม เช่น ฟอร์มและหน้าจอหลัก

          return (
            <div className="min-h-screen bg-gray-50">
              <div className="max-w-4xl mx-auto py-10 px-4">
                <div className="flex justify-between items-center mb-6">
                  <div className="flex gap-2">
                    <select value={selectedMonth} onChange={e => setSelectedMonth(parseInt(e.target.value))} className="px-2 py-1 border rounded">
                      {monthNames.map((month, index) => (
                        <option key={index + 1} value={index + 1}>{month}</option>
                      ))}
                    </select>
                    <select value={selectedYear} onChange={e => setSelectedYear(parseInt(e.target.value))} className="px-2 py-1 border rounded">
                      {Array.from({ length: 5 }, (_, i) => new Date().getFullYear() - 2 + i).map(y => (
                        <option key={y} value={y}>{y}</option>
                      ))}
                    </select>
                  </div>
                  <div className="flex gap-2">
                    <button onClick={() => { setShowAddForm(true); setEditingItem(null); }} className="bg-green-600 text-white px-4 py-2 rounded">+ รายรับ/รายจ่าย</button>
                    <button onClick={() => { setShowCreditForm(true); setEditingItem(null); }} className="bg-indigo-600 text-white px-4 py-2 rounded">+ บัตรเครดิต</button>
                  </div>
                </div>

                <h2 className="text-xl font-bold mb-2">รายรับ/รายจ่าย</h2>
                <table className="w-full table-auto border">
                  <thead>
                    <tr className="bg-gray-200">
                      <th className="p-2 border">ปี</th>
                      <th className="p-2 border">เดือน</th>
                      <th className="p-2 border">รายการ</th>
                      <th className="p-2 border">รายรับ</th>
                      <th className="p-2 border">รายจ่าย</th>
                      <th className="p-2 border">คงเหลือ</th>
                      <th className="p-2 border">จัดการ</th>
                    </tr>
                  </thead>
                  <tbody>
                    {getCurrentMonthData().map((t, index, arr) => {
                      const runningBalance = arr.slice(0, index + 1).reduce((acc, cur) => acc + cur.income - cur.outcome, 0);
                      return (
                        <tr key={t.id}>
                          <td className="p-2 border text-center">{t.year}</td>
                          <td className="p-2 border text-center">{monthNames[t.month - 1]}</td>
                          <td className="p-2 border">{t.item}</td>
                          <td className="p-2 border text-right text-green-600">{t.income ? t.income.toLocaleString() : '-'}</td>
                          <td className="p-2 border text-right text-red-600">{t.outcome ? t.outcome.toLocaleString() : '-'}</td>
                          <td className="p-2 border text-right font-semibold">{runningBalance.toLocaleString()}</td>
                          <td className="p-2 border text-center flex justify-center gap-2">
                            <button onClick={() => { setEditingItem(t); setShowAddForm(true); }} className="text-blue-600"><Edit3 size={16} /></button>
                            <button onClick={() => handleDeleteTransaction(t.id)} className="text-red-600"><Trash2 size={16} /></button>
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>

                <h2 className="text-xl font-bold mt-10 mb-2">ผ่อนบัตรเครดิต</h2>
                <table className="w-full table-auto border">
                  <thead>
                    <tr className="bg-gray-200">
                      <th className="p-2 border">ปี</th>
                      <th className="p-2 border">เดือน</th>
                      <th className="p-2 border">ธนาคาร</th>
                      <th className="p-2 border">รายการ</th>
                      <th className="p-2 border">ยอด/เดือน</th>
                      <th className="p-2 border">จัดการ</th>
                    </tr>
                  </thead>
                  <tbody>
                    {creditInstallments
                      .sort((a, b) => a.item.localeCompare(b.item))
                      .map((c) => (
                      <tr key={c.id}>
                        <td className="p-2 border text-center">{c.year}</td>
                        <td className="p-2 border text-center">{monthNames[c.month - 1]}</td>
                        <td className="p-2 border text-center">{c.bank}</td>
                        <td className="p-2 border">{c.item}</td>
                        <td className="p-2 border text-right">{c.amount.toLocaleString()}</td>
                        <td className="p-2 border text-center flex justify-center gap-2">
                          <button onClick={() => { setEditingItem(c); setShowCreditForm(true); }} className="text-blue-600"><Edit3 size={16} /></button>
                          <button onClick={() => handleDeleteCredit(c.id)} className="text-red-600"><Trash2 size={16} /></button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>

              {showAddForm && (
                <TransactionForm
                  onSubmit={handleAddTransaction}
                  onCancel={() => { setShowAddForm(false); setEditingItem(null); }}
                  editData={editingItem}
                />
              )}

              {showCreditForm && (
                <CreditForm
                  onSubmit={handleAddCredit}
                  onCancel={() => { setShowCreditForm(false); setEditingItem(null); }}
                  editData={editingItem}
                />
              )}
            </div>
          );
        };

        ReactDOM.render(<MonthlyExpenseTracker />, document.getElementById('root'));
    </script>
</body>
</html>
